You are doing internal pentest and you are connected to the attack host (Windows or Linux, whatever your client provided). The attakc host is running in the client's network. However, pentesting from that position is not very beneficial, and you probably already set-up some kind of proxy software like ligolo --- just so you can run Kali commands, through attack host, and into the internal network.   

However, often when you are discovering new hosts or domains, you will find `local domains` such as `KSRMAPP.sandviken.local`. Since your are mainly doing your pentest from Kali now, your DNS resolvers (most probably 9.9.9.9 or 1.1.1.1) do not know what is the IP address of the local domain name. 

So, using domain names in your every-day tools will not work. When you request domain to be resolved that contains `domain.local`, you want the request to go through `ligolo` toward local DNS (not toward 1.1.1.1).

The solution for this small issue is fairly simple: 
##### dnsmasq
Install `dnsmasq` on your Kali:
```
apt install dnsmasq
```

At the end of the file (or anywhere you want), add the following:
```
cat /etc/dnsmasq.conf

<SNIP>
<SNIP>
<SNIP>

# Forward specific domains to local DNS
server=/sandviken.local/172.19.8.21
# Everything else goes to public DNS of your choice!
server=9.9.9.9

END OF THE FILE
```

Which basically tells your Kali:
- All domains that end with sandviken.local, try and resolve via 172.19.8.21 nameserver (` !!! this DNS request should go through your ligolo interface !!!` )
- Everything else goes via 9.9.9.9 (normally through your gateway, and out in public)

Then, edit your `resolv.conf` so the Kali points back to itself:

```
nameserver 127.0.0.1
```

Then, restart `dnsmasq`
```
systemctl restart dnsmasq
```

Test by pinging `domain.local` from Kali
![](ZZZ-resources/Pasted%20image%2020250411201525.png)